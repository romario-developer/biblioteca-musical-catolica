<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repertório - HolyTracks</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Poppins:wght@600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <header class="main-header">
        <a href="index.html" class="logo">Holy<span>Tracks</span></a>
        <nav class="main-nav">
            <a href="index.html">Início</a>
            <a href="biblioteca.html">Biblioteca</a>
            <a href="repertorio.html">Repertório</a>
            <a href="participe.html" class="nav-button">Seja Membro</a>
        </nav>
    </header>

    <main class="main-container">
        <section class="page-header">
            <h1>Sugestões de Repertório</h1>
            <p>Encontre sugestões de repertório geradas aleatoriamente para cada tempo litúrgico.</p>
        </section>

        <div id="repertorio-container" class="repertorio-accordion">
            <p>Carregando sugestões...</p>
        </div>
    </main>

    <footer class="main-footer">
        <div class="main-container footer-content">
            <div class="footer-social">
                <a href="https://instagram.com/seu_usuario" target="_blank" title="Instagram"><img
                        src="https://img.icons8.com/ios-filled/50/A0AEC0/instagram-new.png" alt="Instagram" /></a>
                <a href="https://youtube.com/seu_canal" target="_blank" title="YouTube"><img
                        src="https://img.icons8.com/ios-filled/50/A0AEC0/youtube-play.png" alt="YouTube" /></a>
                <a href="mailto:suporte@holytracks.com" title="Suporte por E-mail"><img
                        src="https://img.icons8.com/ios-filled/50/A0AEC0/mail.png" alt="Suporte" /></a>
            </div>
            <div class="footer-copyright">
                <p>&copy; 2025 HolyTracks. Todos os direitos reservados.</p>
            </div>
            <div class="footer-whatsapp">
                <a href="https://wa.me/5511999999999" target="_blank">Fale Conosco no WhatsApp</a>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const container = document.getElementById("repertorio-container");
            const temposLiturgicos = ["Advento", "Natal", "Quaresma", "Páscoa", "Tempo Comum"];

            container.innerHTML = ""; // Limpa a mensagem de "carregando"

            for (const tempo of temposLiturgicos) {
                const item = document.createElement("div");
                item.className = "accordion-item";
                item.innerHTML = `
                    <button class="accordion-header">
                        <span>Repertório para ${tempo}</span>
                        <span class="accordion-icon">+</span>
                    </button>
                    <div class="accordion-content">
                        <div class="repertorio-list" id="list-${tempo.replace(/\s+/g, "")}">
                            <p>Clique para gerar uma sugestão.</p>
                        </div>
                        <button class="suggest-again-btn" data-tempo="${tempo}">Sugerir Novamente</button>
                    </div>
                `;
                container.appendChild(item);
            }

            document.querySelectorAll(".accordion-header").forEach(header => {
                header.addEventListener("click", () => {
                    const item = header.parentElement;
                    item.classList.toggle("active");
                    const icon = header.querySelector(".accordion-icon");
                    icon.textContent = item.classList.contains("active") ? "-" : "+";
                    // Gera o repertório na primeira vez que abre
                    if (item.classList.contains("active") && item.querySelector(".repertorio-list p")) {
                        const tempo = item.querySelector(".suggest-again-btn").dataset.tempo;
                        gerarRepertorio(tempo);
                    }
                });
            });

            document.querySelectorAll(".suggest-again-btn").forEach(button => {
                button.addEventListener("click", () => {
                    gerarRepertorio(button.dataset.tempo);
                });
            });
        });

        async function gerarRepertorio(tempo) {
            const listContainer = document.getElementById(`list-${tempo.replace(/\s+/g, "")}`);
            listContainer.innerHTML = "<p>Gerando nova sugestão...</p>";

            try {
                const response = await fetch(`https://biblioteca-musical-catolica.onrender.com/api/repertorio-aleatorio?tempo=${tempo}`);
                if (!response.ok) throw new Error("Falha ao gerar repertório.");

                const repertorio = await response.json();
                listContainer.innerHTML = "";

                // CORREÇÃO: Ordem dos momentos atualizada
                const ordemMomentosMissa = ["Entrada", "Ato Penitencial", "Glória", "Salmo", "Aclamação", "Ofertório", "Santo", "Cordeiro", "Comunhão", "Final"];

                // Regra para Quaresma
                const momentosFiltrados = tempo === "Quaresma" ? ordemMomentosMissa.filter(m => m !== "Glória") : ordemMomentosMissa;

                momentosFiltrados.forEach(momento => {
                    const musica = repertorio[momento]; // <--- AQUI ESTÁ A CORREÇÃO
                    const item = document.createElement("div");
                    item.innerHTML = `<h4 class="repertorio-momento">${momento}</h4><ul><li>${musica ? `${musica.titulo} - <em>${musica.artista || "Artista não informado"}</em>` : "<em>Nenhuma música encontrada</em>"}</li></ul>`;
                    listContainer.appendChild(item);
                });

            } catch (error) {
                listContainer.innerHTML = `<p style="color: red;">${error.message}</p>`;
            }
        }
    </script>
</body>

</html>