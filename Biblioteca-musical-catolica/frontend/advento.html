<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advento - Biblioteca Musical Cat√≥lica</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <header class="header">
        <h1>üéµ Advento</h1>
    </header>

    <main class="main-content">
        <h2 class="page-title">Momentos da Missa</h2>
        <div class="moments-grid">
            <div class="moment-item" onclick="openMusicList('Entrada')">
                <h3>Entrada</h3>
            </div>
            <div class="moment-item" onclick="openMusicList('Ato Penitencial')">
                <h3>Ato Penitencial</h3>
            </div>
            <div class="moment-item" onclick="openMusicList('Gl√≥ria')">
                <h3>Gl√≥ria</h3>
            </div>
            <div class="moment-item" onclick="openMusicList('Aclama√ß√£o')">
                <h3>Aclama√ß√£o</h3>
            </div>
            <div class="moment-item" onclick="openMusicList('Ofert√≥rio')">
                <h3>Ofert√≥rio</h3>
            </div>
            <div class="moment-item" onclick="openMusicList('Santo')">
                <h3>Santo</h3>
            </div>
            <div class="moment-item" onclick="openMusicList('Comunh√£o')">
                <h3>Comunh√£o</h3>
            </div>
            <div class="moment-item" onclick="openMusicList('Final')">
                <h3>Final</h3>
            </div>
        </div>
        <a href="index.html" class="back-button">‚Üê Voltar para o In√≠cio</a>
    </main>

    <div id="music-list-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-category-title">Categoria</h2>
                <button class="close-modal-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modal-music-list" class="modal-body"></div>
            <!-- NOVO: Container para os bot√µes de pagina√ß√£o -->
            <div id="modal-pagination" class="pagination-container"></div>
        </div>
    </div>

    <script>
        const modal = document.getElementById('music-list-modal');
        function closeModal() { modal.classList.remove('active'); }

        async function openMusicList(category, page = 1) {
            const modalTitle = document.getElementById('modal-category-title');
            const musicListContainer = document.getElementById('modal-music-list');
            const paginationContainer = document.getElementById('modal-pagination');

            musicListContainer.innerHTML = '<p>Carregando...</p>';
            paginationContainer.innerHTML = '';
            modal.classList.add('active');
            modalTitle.textContent = category;

            try {
                const tempoLiturgico = 'Advento'; // MUDE AQUI PARA CADA P√ÅGINA
                const limit = 5;
                const url = `https://biblioteca-musical-catolica.onrender.com/api/musicas?tempo=${encodeURIComponent(tempoLiturgico)}&momento=${encodeURIComponent(category)}&page=${page}&limit=${limit}`;

                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const data = await response.json();
                const songs = data.musicas;

                musicListContainer.innerHTML = '';

                if (songs.length > 0) {
                    songs.forEach(song => {
                        const item = document.createElement('div');
                        item.className = 'music-item';

                        const title = document.createElement('span');
                        title.className = 'music-title-span';
                        title.textContent = song.titulo;
                        item.appendChild(title);

                        const buttonsContainer = document.createElement('div');
                        buttonsContainer.className = 'action-buttons';

                        if (song.letraUrl) {
                            const letraLink = document.createElement('a');
                            letraLink.href = song.letraUrl;
                            letraLink.textContent = 'Letra';
                            letraLink.className = 'action-btn';
                            letraLink.setAttribute('target', '_blank');
                            buttonsContainer.appendChild(letraLink);
                        }

                        if (song.cifraUrl) {
                            const cifraLink = document.createElement('a');
                            cifraLink.href = song.cifraUrl;
                            cifraLink.textContent = 'Cifra';
                            cifraLink.className = 'action-btn';
                            cifraLink.setAttribute('target', '_blank');
                            buttonsContainer.appendChild(cifraLink);
                        }

                        const downloadLink = document.createElement('a');
                        downloadLink.href = song.downloadUrl;
                        downloadLink.textContent = 'Baixar';
                        downloadLink.className = 'action-btn';
                        downloadLink.setAttribute('target', '_blank');
                        downloadLink.setAttribute('download', '');
                        buttonsContainer.appendChild(downloadLink);

                        item.appendChild(buttonsContainer);
                        musicListContainer.appendChild(item);
                    });

                    // L√ìGICA PARA CRIAR OS BOT√ïES DE PAGINA√á√ÉO
                    if (data.totalPages > 1) {
                        for (let i = 1; i <= data.totalPages; i++) {
                            const pageBtn = document.createElement('button');
                            pageBtn.textContent = i;
                            pageBtn.className = 'pagination-btn';
                            if (i === data.currentPage) {
                                pageBtn.classList.add('active');
                            }
                            pageBtn.onclick = () => openMusicList(category, i);
                            paginationContainer.appendChild(pageBtn);
                        }
                    }

                } else {
                    musicListContainer.innerHTML = '<p>Nenhuma m√∫sica encontrada para esta categoria.</p>';
                }
            } catch (error) {
                console.error('Erro ao buscar m√∫sicas:', error);
                musicListContainer.innerHTML = '<p>Ainda n√£o h√° m√∫sicas para esta categoria.</p>';
            }
        }
    </script>
</body>

</html>