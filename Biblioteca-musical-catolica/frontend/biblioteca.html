<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblioteca - HolyTracks</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Poppins:wght@600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <header class="main-header">
        <a href="index.html" class="logo">Holy<span>Tracks</span></a>
        <nav class="main-nav">
            <a href="index.html">In√≠cio</a>
            <a href="biblioteca.html">Biblioteca</a>
            <a href="repertorio.html">Repert√≥rio</a>
            <a href="participe.html" class="nav-button">Seja Membro</a>
        </nav>
    </header>

    <main class="main-container">
        <section class="page-header">
            <h1>Biblioteca de M√∫sicas</h1>
            <p>Explore todo o nosso acervo. Use a busca para encontrar o que precisa.</p>
            <div class="search-bar-container">
                <input type="text" id="search-input" placeholder="Buscar por t√≠tulo ou artista...">
            </div>
        </section>

        <section class="music-library">
            <div id="library-grid" class="shelf-grid">
                <!-- Os cards das m√∫sicas ser√£o inseridos aqui pelo JavaScript -->
            </div>
            <p id="no-results-message" style="display: none; text-align: center; margin-top: 2rem;">Nenhuma m√∫sica encontrada.</p>
        </section>
    </main>

    <footer class="main-footer">
        <!-- O mesmo footer do index.html -->
        <div class="main-container footer-content">
            <div class="footer-social">
                <a href="https://instagram.com/seu_usuario" target="_blank" title="Instagram"><img src="https://img.icons8.com/ios-filled/50/A0AEC0/instagram-new.png" alt="Instagram"/></a>
                <a href="https://youtube.com/seu_canal" target="_blank" title="YouTube"><img src="https://img.icons8.com/ios-filled/50/A0AEC0/youtube-play.png" alt="YouTube"/></a>
                <a href="mailto:suporte@holytracks.com" title="Suporte por E-mail"><img src="https://img.icons8.com/ios-filled/50/A0AEC0/mail.png" alt="Suporte"/></a>
            </div>
            <div class="footer-copyright">
                <p>&copy; 2025 HolyTracks. Todos os direitos reservados.</p>
            </div>
            <div class="footer-whatsapp">
                <a href="https://wa.me/5511999999999" target="_blank">Fale Conosco no WhatsApp</a>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', ( ) => {
            const searchInput = document.getElementById('search-input');
            const libraryGrid = document.getElementById('library-grid');
            const noResultsMessage = document.getElementById('no-results-message');
            let todasAsMusicas = []; // Array para guardar todas as m√∫sicas carregadas

            // Fun√ß√£o para renderizar os cards na tela
            function renderizarMusicas(musicas) {
                libraryGrid.innerHTML = ''; // Limpa a grade
                if (musicas.length === 0) {
                    noResultsMessage.style.display = 'block';
                } else {
                    noResultsMessage.style.display = 'none';
                }

                musicas.forEach(musica => {
                    // Usaremos o mesmo estilo dos cards da p√°gina inicial
                    const card = document.createElement('a');
                    card.className = 'category-card'; // Reutilizando a classe
                    // Futuramente, o link pode levar para uma p√°gina de detalhes da m√∫sica
                    card.href = '#'; 

                    // Tenta usar a imagem da m√∫sica, se n√£o houver, usa um √≠cone padr√£o
                    const artworkContent = musica.imageUrl 
                        ? `<div class="card-artwork" style="background-image: url('${musica.imageUrl}')"></div>`
                        : `<div class="card-artwork">üéµ</div>`;

                    card.innerHTML = `
                        ${artworkContent}
                        <div class="card-info">
                            <div class="card-title">${musica.titulo}</div>
                            <div class="card-description">${musica.artista || 'Artista n√£o informado'}</div>
                        </div>
                    `;
                    libraryGrid.appendChild(card);
                });
            }

            // Fun√ß√£o para filtrar as m√∫sicas
            function filtrarMusicas() {
                const termo = searchInput.value.toLowerCase();
                const musicasFiltradas = todasAsMusicas.filter(musica => {
                    const titulo = musica.titulo ? musica.titulo.toLowerCase() : '';
                    const artista = musica.artista ? musica.artista.toLowerCase() : '';
                    return titulo.includes(termo) || artista.includes(termo);
                });
                renderizarMusicas(musicasFiltradas);
            }

            // Carrega todas as m√∫sicas da API
            async function carregarTodaBiblioteca() {
                try {
                    libraryGrid.innerHTML = '<p>Carregando biblioteca...</p>';
                    const response = await fetch('https://biblioteca-musical-catolica.onrender.com/api/musicas/all' );
                    if (!response.ok) throw new Error('Falha ao carregar a biblioteca.');
                    
                    todasAsMusicas = await response.json();
                    renderizarMusicas(todasAsMusicas);

                    // Adiciona o "ouvinte" do evento de digita√ß√£o AP√ìS carregar os dados
                    searchInput.addEventListener('input', filtrarMusicas);

                } catch (error) {
                    libraryGrid.innerHTML = `<p style="color: red;">${error.message}</p>`;
                }
            }

            carregarTodaBiblioteca();
        });
    </script>
</body>
</html>
