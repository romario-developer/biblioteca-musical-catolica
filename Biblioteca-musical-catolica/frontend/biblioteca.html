<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblioteca - HolyTracks</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Poppins:wght@600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <header class="main-header">
        <a href="index.html" class="logo">Holy<span>Tracks</span></a>
        <nav class="main-nav">
            <a href="index.html">In√≠cio</a>
            <a href="biblioteca.html">Biblioteca</a>
            <a href="repertorio.html">Repert√≥rio</a>
            <a href="participe.html" class="nav-button">Seja Membro</a>
        </nav>
    </header>

    <main class="main-container">
        <section class="page-header">
            <h1>Biblioteca de M√∫sicas</h1>
            <p>Explore todo o nosso acervo. Use a busca para encontrar o que precisa.</p>
            <div class="search-bar-container">
                <input type="text" id="search-input" placeholder="Buscar por t√≠tulo ou artista...">
            </div>
            <div class="view-toggle">
                <button id="grid-view-btn" class="active">Grade</button>
                <button id="list-view-btn">Lista</button>
            </div>
        </section>

        <section class="music-library">
            <div id="library-grid" class="shelf-grid">
                <!-- Os cards das m√∫sicas ser√£o inseridos aqui pelo JavaScript -->
            </div>
            <div id="library-list" class="music-list" style="display: none;">
                <table>
                    <thead>
                        <tr>
                            <th>T√≠tulo</th>
                            <th>Artista</th>
                            <th>Tempo Lit√∫rgico</th>
                            <th>Momento</th>
                            <th>Tom</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- As linhas da tabela ser√£o inseridas aqui pelo JavaScript -->
                    </tbody>
                </table>
            </div>
            <p id="no-results-message" style="display: none; text-align: center; margin-top: 2rem;">Nenhuma m√∫sica
                encontrada.</p>
        </section>
    </main>

    <footer class="main-footer">
        <!-- O mesmo footer do index.html -->
        <div class="main-container footer-content">
            <div class="footer-social">
                <a href="https://instagram.com/seu_usuario" target="_blank" title="Instagram"><img
                        src="https://img.icons8.com/ios-filled/50/A0AEC0/instagram-new.png" alt="Instagram" /></a>
                <a href="https://youtube.com/seu_canal" target="_blank" title="YouTube"><img
                        src="https://img.icons8.com/ios-filled/50/A0AEC0/youtube-play.png" alt="YouTube" /></a>
                <a href="mailto:suporte@holytracks.com" title="Suporte por E-mail"><img
                        src="https://img.icons8.com/ios-filled/50/A0AEC0/mail.png" alt="Suporte" /></a>
            </div>
            <div class="footer-copyright">
                <p>&copy; 2025 HolyTracks. Todos os direitos reservados.</p>
            </div>
            <div class="footer-whatsapp">
                <a href="https://wa.me/5511999999999" target="_blank">Fale Conosco no WhatsApp</a>
            </div>
        </div>
    </footer>

    <!-- Painel Lateral de Detalhes da M√∫sica -->
    <div id="music-detail-panel" class="music-detail-panel">
        <button class="close-panel-btn">&times;</button>
        <div class="panel-content">
            <div class="panel-artwork" id="detail-artwork"></div>
            <h2 id="detail-title"></h2>
            <p id="detail-artist"></p>
            <p id="detail-tempo-momento"></p>
            <p id="detail-tom"></p>
            <div class="panel-actions">
                <a id="btn-letra" href="#" target="_blank" class="action-btn">Letra</a>
                <a id="btn-cifra" href="#" target="_blank" class="action-btn">Cifra</a>
                <a id="btn-download" href="#" target="_blank" class="action-btn primary-btn">Baixar Multitrack</a>
            </div>
        </div>
    </div>

    <!-- Overlay para fechar o painel ao clicar fora -->
    <div id="panel-overlay" class="overlay-active"></div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const searchInput = document.getElementById("search-input");
            const libraryGrid = document.getElementById("library-grid");
            const libraryList = document.getElementById("library-list"); // Novo elemento da lista
            const noResultsMessage = document.getElementById("no-results-message");
            const musicDetailPanel = document.getElementById("music-detail-panel");
            const closePanelBtn = document.querySelector(".close-panel-btn");
            const panelOverlay = document.getElementById("panel-overlay");
            const gridViewBtn = document.getElementById("grid-view-btn"); // Bot√£o de grade
            const listViewBtn = document.getElementById("list-view-btn"); // Bot√£o de lista
            let todasAsMusicas = [];
            let currentView = "grid"; // Estado inicial da visualiza√ß√£o

            // Fun√ß√£o para renderizar as m√∫sicas (adaptada para grade ou lista)
            function renderizarMusicas(musicas) {
                libraryGrid.innerHTML = "";
                libraryList.querySelector("tbody").innerHTML = ""; // Limpa o corpo da tabela

                if (musicas.length === 0) {
                    noResultsMessage.style.display = "block";
                } else {
                    noResultsMessage.style.display = "none";
                }

                musicas.forEach(musica => {
                    // Renderiza para a visualiza√ß√£o em grade
                    const card = document.createElement("div");
                    card.className = "category-card";
                    card.dataset.id = musica._id;
                    const artworkContent = musica.imageUrl
                        ? `<div class="card-artwork" style="background-image: url(\'${musica.imageUrl}\')"></div>`
                        : `<div class="card-artwork">üéµ</div>`;
                    card.innerHTML = `
                        ${artworkContent}
                        <div class="card-info">
                            <div class="card-title">${musica.titulo}</div>
                            <div class="card-description">${musica.artista || "Artista n√£o informado"}</div>
                        </div>
                    `;
                    card.addEventListener("click", () => openMusicDetailPanel(musica));
                    libraryGrid.appendChild(card);

                    // Renderiza para a visualiza√ß√£o em lista (tabela)
                    const row = document.createElement("tr");
                    row.dataset.id = musica._id;
                    row.innerHTML = `
                        <td>${musica.titulo}</td>
                        <td>${musica.artista || "Artista n√£o informado"}</td>
                        <td>${musica.tempo}</td>
                        <td>${musica.momento}</td>
                        <td>${musica.tom || "N√£o informado"}</td>
                    `;
                    row.addEventListener("click", () => openMusicDetailPanel(musica));
                    libraryList.querySelector("tbody").appendChild(row);
                });

                // Exibe a visualiza√ß√£o correta
                if (currentView === "grid") {
                    libraryGrid.style.display = "grid";
                    libraryList.style.display = "none";
                } else {
                    libraryGrid.style.display = "none";
                    libraryList.style.display = "block";
                }
            }

            // Fun√ß√£o para filtrar as m√∫sicas
            function filtrarMusicas() {
                const termo = searchInput.value.toLowerCase();
                const musicasFiltradas = todasAsMusicas.filter(musica => {
                    const titulo = musica.titulo ? musica.titulo.toLowerCase() : "";
                    const artista = musica.artista ? musica.artista.toLowerCase() : "";
                    return titulo.includes(termo) || artista.includes(termo);
                });
                renderizarMusicas(musicasFiltradas);
            }

            // Carrega todas as m√∫sicas da API
            async function carregarTodaBiblioteca() {
                try {
                    libraryGrid.innerHTML = "<p>Carregando biblioteca...</p>";
                    libraryList.querySelector("tbody").innerHTML = "<tr><td colspan=\"5\">Carregando biblioteca...</td></tr>";
                    const response = await fetch("https://biblioteca-musical-catolica.onrender.com/api/musicas/all");
                    if (!response.ok) throw new Error("Falha ao carregar a biblioteca.");

                    todasAsMusicas = await response.json();
                    renderizarMusicas(todasAsMusicas);

                    searchInput.addEventListener("input", filtrarMusicas);

                } catch (error) {
                    libraryGrid.innerHTML = `<p style="color: red;">${error.message}</p>`;
                    libraryList.querySelector("tbody").innerHTML = `<tr><td colspan=\"5\" style=\"color: red;\">${error.message}</td></tr>`;
                }
            }

            // Fun√ß√£o para abrir e popular o painel de detalhes da m√∫sica
            function openMusicDetailPanel(musica) {
                document.getElementById("detail-artwork").style.backgroundImage = musica.imageUrl ? `url(\'${musica.imageUrl}\')` : "none";
                document.getElementById("detail-artwork").textContent = musica.imageUrl ? "" : "üéµ";
                document.getElementById("detail-title").textContent = musica.titulo;
                document.getElementById("detail-artist").textContent = musica.artista || "Artista n√£o informado";
                document.getElementById("detail-tempo-momento").textContent = `${musica.tempo} - ${musica.momento}`;
                document.getElementById("detail-tom").textContent = `Tom: ${musica.tom || "N√£o informado"}`;

                document.getElementById("btn-letra").href = musica.letraUrl || "#";
                document.getElementById("btn-letra").style.display = musica.letraUrl ? "block" : "none";

                document.getElementById("btn-cifra").href = musica.cifraUrl || "#";
                document.getElementById("btn-cifra").style.display = musica.cifraUrl ? "block" : "none";

                document.getElementById("btn-download").href = musica.downloadUrl || "#";
                document.getElementById("btn-download").style.display = musica.downloadUrl ? "block" : "none";

                musicDetailPanel.classList.add("active");
                panelOverlay.classList.add("active");
            }

            // Fun√ß√£o para fechar o painel de detalhes da m√∫sica
            function closeMusicDetailPanel() {
                musicDetailPanel.classList.remove("active");
                panelOverlay.classList.remove("active");
            }

            // Event listeners para os bot√µes de visualiza√ß√£o
            gridViewBtn.addEventListener("click", () => {
                currentView = "grid";
                gridViewBtn.classList.add("active");
                listViewBtn.classList.remove("active");
                renderizarMusicas(todasAsMusicas); // Renderiza novamente para aplicar a visualiza√ß√£o
            });

            listViewBtn.addEventListener("click", () => {
                currentView = "list";
                listViewBtn.classList.add("active");
                gridViewBtn.classList.remove("active");
                renderizarMusicas(todasAsMusicas); // Renderiza novamente para aplicar a visualiza√ß√£o
            });

            closePanelBtn.addEventListener("click", closeMusicDetailPanel);
            panelOverlay.addEventListener("click", closeMusicDetailPanel);
            musicDetailPanel.addEventListener("click", (event) => {
                event.stopPropagation();
            });

            carregarTodaBiblioteca();
        });
    </script>
</body>

</html>